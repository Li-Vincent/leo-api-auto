webpackJsonp([26],{"+U2/":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("EMlb"),l=a("6Vxk"),r=a("Tr1n"),i={name:"PlanDetail",data:function(){var e=this;return{mailGroupList:[],projects:[],priorityOptions:[{label:"ALL",value:"ALL"},{label:"P1",value:"P1"},{label:"P2",value:"P2"}],form:{name:"",description:"",isParallel:!1,secretToken:"",hookUrl:"",curlScript:"",enableWXWorkNotify:!1,WXWorkAPIKey:"",WXWorkMentionMobileList:[],alwaysWXWorkNotify:!1,enableDingTalkNotify:!1,DingTalkAccessToken:"",DingTalkAtMobiles:[],DingTalkSecret:"",alwaysDingTalkNotify:!1,alarmMailGroupList:[],alwaysSendMail:!1,executionRange:[{projectId:"",priority:"ALL"}]},formRules:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:1,max:100,message:"长度在 1 到 100 个字符",trigger:"blur"}],executionRange:[{required:!0,message:"请选择测试范围",trigger:"blur"}],isParallel:[{required:!0,type:"boolean",message:"请选择是否并发",trigger:"blur"}],range_projectId:[{required:!0,message:"请选择项目",trigger:"blur"}],range_priority:[{required:!0,message:"请选择优先级",trigger:"blur"},{validator:function(t,a,o){"ALL"!=a&&"P1"!=a&&"P2"!=a?(o(new Error("请正确选择优先级")),e.$message.warning({message:"请正确选择优先级!",center:!0})):o()},trigger:"blur"}]}}},methods:{getProjectList:function(){var e=this,t={size:this.size,skip:this.skip,sortBy:this.sortBy,order:this.order,projectTestType:"apiTest"};this.listLoading=!0;Object(o.c)(t,{}).then(function(t){e.listLoading=!1;var a=t.status,o=t.data;"ok"===a?(e.totalNum=o.totalNum,e.projects=o.rows):e.$message.error({message:o,center:!0})}).catch(function(t){e.$message.err({message:"项目获取失败，请稍后刷新重试哦~",center:!0}),e.listLoading=!1})},addExecutionRange:function(){this.form.executionRange.push({projectId:"",priority:"ALL"})},delExecutionRange:function(e){this.form.executionRange.splice(e,1),0===this.form.executionRange.length&&this.form.executionRange.push({projectId:"",priority:""})},checkExecutionRange:function(){if(this.form.executionRange.length>1)for(var e=this.form.executionRange.length,t=0;t<e;t++)for(var a=t+1;a<e;a++)if(this.form.executionRange[t].projectId==this.form.executionRange[a].projectId)return this.$message.warning({message:"请不要重复选择项目!",center:!0}),!1;return!0},getPlanDetailInfo:function(){var e=this;Object(l.c)(e.$route.params.plan_id).then(function(t){var a=t.status,o=t.data;"ok"===a&&(e.form.name=o.name,e.form.description=o.description,e.form.isParallel=o.isParallel,e.form.secretToken=o.secretToken,e.form.executionRange=o.executionRange,e.form.hookUrl=window.document.location.protocol+"//"+window.document.location.host+"/api/plan/"+e.$route.params.plan_id+"/executePlanByWebHook",e.form.curlScript='curl -d "testEnvId=${testEnvId}&secretToken='+e.form.secretToken+'&executionRemark=${remark}" "'+e.form.hookUrl+'"',e.form.enableWXWorkNotify=o.enableWXWorkNotify,e.form.WXWorkAPIKey=o.WXWorkAPIKey,e.form.WXWorkMentionMobileList=o.WXWorkMentionMobileList,o.enableWXWorkNotify&&(e.form.alwaysWXWorkNotify=o.alwaysWXWorkNotify),e.form.enableDingTalkNotify=o.enableDingTalkNotify,e.form.DingTalkAccessToken=o.DingTalkAccessToken,e.form.DingTalkAtMobiles=o.DingTalkAtMobiles,e.form.DingTalkSecret=o.DingTalkSecret,o.enableDingTalkNotify&&(e.form.alwaysDingTalkNotify=o.alwaysDingTalkNotify),e.form.alarmMailGroupList=o.alarmMailGroupList,o.alwaysSendMail&&(e.form.alwaysSendMail=o.alwaysSendMail))}).catch(function(t){e.$message.error({message:"计划详情获取失败，请稍后刷新重试哦~",center:!0}),e.listLoading=!1})},updatePlanInfo:function(){var e=this;this.$refs.form.validate(function(t){t&&e.checkExecutionRange()&&e.$confirm("确认提交吗？","提示",{}).then(function(){var t=e;if(!t.form.enableWXWorkNotify||t.form.WXWorkAPIKey)if(!t.form.enableDingTalkNotify||t.form.DingTalkAccessToken){var a={name:t.form.name.trim(),description:t.form.description.trim(),isParallel:t.form.isParallel,secretToken:t.form.secretToken,enableWXWorkNotify:t.form.enableWXWorkNotify,WXWorkAPIKey:t.form.WXWorkAPIKey,WXWorkMentionMobileList:t.form.WXWorkMentionMobileList,alwaysWXWorkNotify:t.form.alwaysWXWorkNotify,enableDingTalkNotify:t.form.enableDingTalkNotify,DingTalkAccessToken:t.form.DingTalkAccessToken,DingTalkAtMobiles:t.form.DingTalkAtMobiles,DingTalkSecret:t.form.DingTalkSecret,alwaysDingTalkNotify:t.form.alwaysDingTalkNotify,alarmMailGroupList:t.form.alarmMailGroupList,alwaysSendMail:t.form.alwaysSendMail,executionRange:t.form.executionRange,lastUpdateUser:t.$store.getters.email||"anonymous"};Object(l.e)(t.$route.params.plan_id,a,{}).then(function(e){var a=e.status,o=e.data;"ok"===a?(t.$router.push({name:"PlanList"}),t.$message({message:"修改成功",center:!0,type:"success"})):t.$message.error({message:o,center:!0})})}else t.$message.error({message:"钉钉AccessToken不能为空！",center:!0});else t.$message.error({message:"企业微信APIKey不能为空！",center:!0})})})},getMailGroupList:function(){this.listLoading=!0;var e=this;Object(r.c)({status:!0}).then(function(t){var a=t.status,o=t.data;e.listLoading=!1,"ok"===a?(e.totalNum=o.totalNum,e.mailGroupList=o.rows):e.$message.error({message:o,center:!0})}).catch(function(t){e.$message.error({message:"邮件组列表获取失败，请稍后刷新重试哦~",center:!0}),e.listLoading=!1})},checkActiveMail:function(){this.mailGroupList.length<1&&this.$message.warning({message:"未找到「启用的邮件组」哦, 请通知管理员前往「邮件配置」进行设置",center:!0})}},mounted:function(){this.getProjectList(),this.getPlanDetailInfo(),this.getMailGroupList()}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("el-row",[a("strong",{staticClass:"title"},[e._v(e._s(e.$route.meta.title))])]),e._v(" "),a("el-row",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"}},[a("router-link",{staticStyle:{"text-decoration":"none",color:"aliceblue"},attrs:{to:{name:"PlanList"}}},[a("el-button",{staticClass:"return-list"},[a("i",{staticClass:"el-icon-d-arrow-left",staticStyle:{"margin-right":"5px"},attrs:{"return-list":""}}),e._v("返回\n      ")])],1),e._v(" "),a("div",{staticStyle:{float:"right","margin-right":"80px"}},[a("router-link",{staticStyle:{"text-decoration":"none",color:"aliceblue"},attrs:{to:{name:"PlanList"}}},[a("el-button",{staticClass:"return-list"},[a("i",{staticClass:"el-icon-close",staticStyle:{"margin-right":"5px"},attrs:{"return-list":""}}),e._v("取消\n        ")])],1),e._v(" "),a("el-button",{staticClass:"return-list",attrs:{type:"primary"},nativeOn:{click:function(t){return e.updatePlanInfo(t)}}},[a("i",{staticClass:"el-icon-check",staticStyle:{"margin-right":"5px"},attrs:{"return-list":""}}),e._v("保存\n      ")])],1)],1),e._v(" "),a("el-row",[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.formRules}},[a("div",{staticStyle:{border:"1px solid #e6e6e6","margin-bottom":"10px",padding:"15px"}},[a("el-row",[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:"计划名称:","label-width":"120px",prop:"name"}},[a("el-input",{attrs:{placeholder:"名称","auto-complete":""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",[a("el-form-item",{attrs:{label:"是否并行:","label-width":"120px",prop:"isParallel"}},[a("el-radio",{attrs:{label:!0},model:{value:e.form.isParallel,callback:function(t){e.$set(e.form,"isParallel",t)},expression:"form.isParallel"}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:!1},model:{value:e.form.isParallel,callback:function(t){e.$set(e.form,"isParallel",t)},expression:"form.isParallel"}},[e._v("否")])],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:"计划描述:","label-width":"120px",prop:"description"}},[a("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入计划描述","auto-complete":""},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:"secretToken:","label-width":"120px",prop:"secretToken"}},[a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("span",[e._v("secretToken：通过第三方平台trigger执行plan时用于进行校验的token，如不需要第三方trigger，可不填")])]),e._v(" "),a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.form.secretToken,callback:function(t){e.$set(e.form,"secretToken",t)},expression:"form.secretToken"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:"CURL Script:","label-width":"120px",prop:"curlScript"}},[a("el-tooltip",{attrs:{effect:"dark",placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("span",[e._v("请将如下脚本信息补全（ testEnvId请进入环境配置查询ID，remark为自定义标记,可填入jenkins job name）")]),a("br"),e._v(" "),a("span",[e._v("将补全的curl Script 填入jenkins job - Build - Execute Shell中即可通过jenkins trigger执行plan")]),a("br"),e._v(" "),a("span",[e._v("注意:curl脚本不能换行")])]),e._v(" "),a("el-input",{attrs:{type:"textarea","auto-complete":"off",readonly:""},model:{value:e.form.curlScript,callback:function(t){e.$set(e.form,"curlScript",t)},expression:"form.curlScript"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:22}},[a("el-form-item",{attrs:{label:"测试范围:",prop:"executionRange","label-width":"120px"}},[a("el-table",{attrs:{data:e.form.executionRange,"highlight-current-row":""}},[a("el-table-column",{attrs:{label:"项目","min-width":"30%",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{prop:"executionRange."+t.$index+".projectId",rules:e.formRules.range_projectId}},[a("el-select",{staticStyle:{width:"90%"},attrs:{prop:"executionRange."+t.$index+".projectId",placeholder:"请选择项目",clearable:"",filterable:"","allow-create":"","default-first-option":""},model:{value:t.row.projectId,callback:function(a){e.$set(t.row,"projectId",a)},expression:"scope.row.projectId"}},e._l(e.projects,function(e,t){return a("el-option",{key:t+"",attrs:{label:e.name,value:e._id}})}),1)],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"优先级","min-width":"10%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{prop:"executionRange."+t.$index+".priority",rules:e.formRules.range_priority}},[a("el-select",{staticStyle:{width:"90%"},attrs:{placeholder:"请选择优先级",clearable:"",filterable:"","allow-create":"","default-first-option":""},model:{value:t.row.priority,callback:function(a){e.$set(t.row,"priority",a)},expression:"scope.row.priority"}},e._l(e.priorityOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"5%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",[a("i",{staticClass:"el-icon-delete",staticStyle:{"font-size":"30px",cursor:"pointer"},on:{click:function(a){return e.delExecutionRange(t.$index)}}})])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"","min-width":"10%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",[t.$index===e.form.executionRange.length-1?a("el-button",{staticClass:"el-icon-plus",attrs:{size:"mini"},on:{click:e.addExecutionRange}}):e._e()],1)]}}])})],1)],1)],1)],1)],1),e._v(" "),a("div",{staticStyle:{border:"1px solid #e6e6e6","margin-bottom":"10px",padding:"15px"}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{staticStyle:{"border-bottom":"1px solid #e6e6e6",margin:"20px"},attrs:{span:20}},[a("el-form-item",{attrs:{label:"企业微信通知","label-width":"120px",prop:"enableWXWorkNotify"}},[a("el-radio",{attrs:{label:!0},model:{value:e.form.enableWXWorkNotify,callback:function(t){e.$set(e.form,"enableWXWorkNotify",t)},expression:"form.enableWXWorkNotify"}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:!1},model:{value:e.form.enableWXWorkNotify,callback:function(t){e.$set(e.form,"enableWXWorkNotify",t)},expression:"form.enableWXWorkNotify"}},[e._v("否")])],1),e._v(" "),a("transition",{attrs:{name:"el-zoom-in-top"}},[e.form.enableWXWorkNotify?a("div",{staticClass:"form-item-sub form-item-short"},[a("el-form-item",{attrs:{"label-width":"120px",label:"企业微信APIKey",prop:"WXWorkAPIKey"}},[a("el-input",{attrs:{placeholder:"请填写企业微信群机器人WebhookAPIKey，如: 6789f5f7-736a-423b-b140-98d8324cb8cb","auto-complete":"off"},model:{value:e.form.WXWorkAPIKey,callback:function(t){e.$set(e.form,"WXWorkAPIKey","string"==typeof t?t.trim():t)},expression:"form.WXWorkAPIKey"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.form.enableWXWorkNotify,expression:"form.enableWXWorkNotify"}],attrs:{"label-width":"120px",label:"通知策略"}},[a("el-radio",{attrs:{label:!0},model:{value:e.form.alwaysWXWorkNotify,callback:function(t){e.$set(e.form,"alwaysWXWorkNotify",t)},expression:"form.alwaysWXWorkNotify"}},[e._v("执行成功也发送通知")]),e._v(" "),a("el-radio",{attrs:{label:!1},model:{value:e.form.alwaysWXWorkNotify,callback:function(t){e.$set(e.form,"alwaysWXWorkNotify",t)},expression:"form.alwaysWXWorkNotify"}},[e._v("执行失败才发送通知")])],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.form.enableWXWorkNotify,expression:"form.enableWXWorkNotify"}],attrs:{"label-width":"120px",label:"提醒手机号列表"}},[a("el-select",{staticStyle:{width:"70%"},attrs:{multiple:"",clearable:"",filterable:"","default-first-option":"","allow-create":"",placeholder:"手机号列表，提醒手机号对应的群成员(@某个成员)，@all表示提醒所有人"},model:{value:e.form.WXWorkMentionMobileList,callback:function(t){e.$set(e.form,"WXWorkMentionMobileList","string"==typeof t?t.trim():t)},expression:"form.WXWorkMentionMobileList"}})],1)],1):e._e()])],1)],1),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{staticStyle:{"border-bottom":"1px solid #e6e6e6",margin:"20px"},attrs:{span:20}},[a("el-form-item",{attrs:{label:"钉钉通知","label-width":"120px",prop:"enableDingTalkNotify"}},[a("el-radio",{attrs:{label:!0},model:{value:e.form.enableDingTalkNotify,callback:function(t){e.$set(e.form,"enableDingTalkNotify",t)},expression:"form.enableDingTalkNotify"}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:!1},model:{value:e.form.enableDingTalkNotify,callback:function(t){e.$set(e.form,"enableDingTalkNotify",t)},expression:"form.enableDingTalkNotify"}},[e._v("否")])],1),e._v(" "),a("transition",{attrs:{name:"el-zoom-in-top"}},[e.form.enableDingTalkNotify?a("div",{staticClass:"form-item-sub form-item-short"},[a("el-form-item",{attrs:{"label-width":"120px",label:"AccessToken",prop:"DingTalkAccessToken"}},[a("el-input",{attrs:{placeholder:"请填写钉钉群机器人DingTalkAccessToken","auto-complete":"off"},model:{value:e.form.DingTalkAccessToken,callback:function(t){e.$set(e.form,"DingTalkAccessToken","string"==typeof t?t.trim():t)},expression:"form.DingTalkAccessToken"}})],1),e._v(" "),a("el-form-item",{attrs:{"label-width":"120px",label:"钉钉加签密钥",prop:"DingTalkSecret"}},[a("el-input",{attrs:{placeholder:"钉钉机器人安全设置勾选加签后须填写Secret,如不勾选可不填","auto-complete":"off"},model:{value:e.form.DingTalkSecret,callback:function(t){e.$set(e.form,"DingTalkSecret","string"==typeof t?t.trim():t)},expression:"form.DingTalkSecret"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.form.enableDingTalkNotify,expression:"form.enableDingTalkNotify"}],attrs:{"label-width":"120px",label:"通知策略"}},[a("el-radio",{attrs:{label:!0},model:{value:e.form.alwaysDingTalkNotify,callback:function(t){e.$set(e.form,"alwaysDingTalkNotify",t)},expression:"form.alwaysDingTalkNotify"}},[e._v("执行成功也发送通知")]),e._v(" "),a("el-radio",{attrs:{label:!1},model:{value:e.form.alwaysDingTalkNotify,callback:function(t){e.$set(e.form,"alwaysDingTalkNotify",t)},expression:"form.alwaysDingTalkNotify"}},[e._v("执行失败才发送通知")])],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.form.enableDingTalkNotify,expression:"form.enableDingTalkNotify"}],attrs:{"label-width":"120px",label:"提醒手机号列表"}},[a("el-select",{staticStyle:{width:"70%"},attrs:{multiple:"",clearable:"",filterable:"","default-first-option":"","allow-create":"",placeholder:"手机号列表，提醒手机号对应的群成员(@某个成员)，@all表示提醒所有人"},model:{value:e.form.DingTalkAtMobiles,callback:function(t){e.$set(e.form,"DingTalkAtMobiles","string"==typeof t?t.trim():t)},expression:"form.DingTalkAtMobiles"}})],1)],1):e._e()])],1)],1),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{staticStyle:{"border-bottom":"1px solid #e6e6e6",margin:"20px"},attrs:{span:20}},[a("el-form-item",{attrs:{label:"告警邮件组","label-width":"120px",prop:"alarmMailGroupList"}},[a("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",multiple:"",placeholder:"请选择告警报告接受者(可多选)"},on:{"visible-change":e.checkActiveMail},model:{value:e.form.alarmMailGroupList,callback:function(t){e.$set(e.form,"alarmMailGroupList",t)},expression:"form.alarmMailGroupList"}},e._l(e.mailGroupList,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e._id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"触发邮件","label-width":"120px",prop:"alwaysSendMail"}},[a("el-radio-group",{model:{value:e.form.alwaysSendMail,callback:function(t){e.$set(e.form,"alwaysSendMail",t)},expression:"form.alwaysSendMail"}},[a("el-radio",{attrs:{label:!0}},[e._v("执行成功也触发邮件")]),e._v(" "),a("el-radio",{attrs:{label:!1}},[e._v("执行失败才触发邮件")])],1)],1)],1)],1)],1)])],1)],1)},staticRenderFns:[]};var s=a("VU/8")(i,n,!1,function(e){a("Bvjl")},"data-v-2d764412",null);t.default=s.exports},Bvjl:function(e,t){}});
//# sourceMappingURL=26.2eb809349907cea05be3.js.map