webpackJsonp([27],{"+U2/":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("EMlb"),l=r("6Vxk"),i=r("Tr1n"),o={name:"PlanDetail",data:function(){var e=this;return{mailGroupList:[],projects:[],priorityOptions:[{label:"ALL",value:"ALL"},{label:"P1",value:"P1"},{label:"P2",value:"P2"}],form:{name:"",description:"",isParallel:!1,secretToken:"",hookUrl:"http://localhost:8080/plan/5fa8b3b5745763b16e85389e/run",alarmMailGroupList:[],alwaysSendMail:!1,executionRange:[{projectId:"",priority:"ALL"}]},formRules:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:1,max:100,message:"长度在 1 到 100 个字符",trigger:"blur"}],executionRange:[{required:!0,message:"请选择测试范围",trigger:"blur"}],isParallel:[{required:!0,type:"boolean",message:"请选择是否并发",trigger:"blur"}],range_projectId:[{required:!0,message:"请选择项目",trigger:"blur"}],range_priority:[{required:!0,message:"请选择优先级",trigger:"blur"},{validator:function(t,r,a){"ALL"!=r&&"P1"!=r&&"P2"!=r?(a(new Error("请正确选择优先级")),e.$message.warning({message:"请正确选择优先级!",center:!0})):a()},trigger:"blur"}]}}},methods:{getProjectList:function(){var e=this,t={size:this.size,skip:this.skip,sortBy:this.sortBy,order:this.order,projectTestType:"apiTest"};this.listLoading=!0;Object(a.c)(t,{}).then(function(t){e.listLoading=!1;var r=t.status,a=t.data;"ok"===r?(e.totalNum=a.totalNum,e.projects=a.rows):e.$message.error({message:a,center:!0})}).catch(function(t){e.$message.err({message:"项目获取失败，请稍后刷新重试哦~",center:!0}),e.listLoading=!1})},addExecutionRange:function(){this.form.executionRange.push({projectId:"",priority:"ALL"})},delExecutionRange:function(e){this.form.executionRange.splice(e,1),0===this.form.executionRange.length&&this.form.executionRange.push({projectId:"",priority:""})},checkExecutionRange:function(){if(this.form.executionRange.length>1)for(var e=this.form.executionRange.length,t=0;t<e;t++)for(var r=t+1;r<e;r++)if(this.form.executionRange[t].projectId==this.form.executionRange[r].projectId)return this.$message.warning({message:"请不要重复选择项目!",center:!0}),!1;return!0},getPlanDetailInfo:function(){var e=this;Object(l.c)(e.$route.params.plan_id).then(function(t){var r=t.status,a=t.data;"ok"===r&&(e.form.name=a.name,e.form.description=a.description,e.form.isParallel=a.isParallel,e.form.secretToken=a.secretToken,e.form.executionRange=a.executionRange,e.form.alarmMailGroupList=a.alarmMailGroupList,a.alwaysSendMail&&(e.form.alwaysSendMail=a.alwaysSendMail))}).catch(function(t){e.$message.error({message:"计划详情获取失败，请稍后刷新重试哦~",center:!0}),e.listLoading=!1})},updatePlanInfo:function(){var e=this;this.$refs.form.validate(function(t){t&&e.checkExecutionRange()&&e.$confirm("确认提交吗？","提示",{}).then(function(){var t=e,r={name:t.form.name.trim(),description:t.form.description.trim(),isParallel:t.form.isParallel,secretToken:t.form.secretToken,alarmMailGroupList:t.form.alarmMailGroupList,alwaysSendMail:t.form.alwaysSendMail,executionRange:t.form.executionRange,lastUpdateUser:t.$store.getters.email||"anonymous"};Object(l.e)(t.$route.params.plan_id,r,{}).then(function(e){var r=e.status,a=e.data;"ok"===r?(t.$router.push({name:"PlanList"}),t.$message({message:"修改成功",center:!0,type:"success"})):t.$message.error({message:a,center:!0})})})})},getMailGroupList:function(){this.listLoading=!0;var e=this;Object(i.c)({status:!0}).then(function(t){var r=t.status,a=t.data;e.listLoading=!1,"ok"===r?(e.totalNum=a.totalNum,e.mailGroupList=a.rows):e.$message.error({message:a,center:!0})}).catch(function(t){e.$message.error({message:"邮件组列表获取失败，请稍后刷新重试哦~",center:!0}),e.listLoading=!1})},checkActiveMail:function(){this.mailGroupList.length<1&&this.$message.warning({message:"未找到「启用的邮件组」哦, 请通知管理员前往「邮件配置」进行设置",center:!0})}},mounted:function(){this.getProjectList(),this.getPlanDetailInfo(),this.getMailGroupList()}},s={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",[r("el-row",[r("strong",{staticClass:"title"},[e._v(e._s(e.$route.meta.title))])]),e._v(" "),r("el-row",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"}},[r("router-link",{staticStyle:{"text-decoration":"none",color:"aliceblue"},attrs:{to:{name:"PlanList"}}},[r("el-button",{staticClass:"return-list"},[r("i",{staticClass:"el-icon-d-arrow-left",staticStyle:{"margin-right":"5px"},attrs:{"return-list":""}}),e._v("返回\n        ")])],1),e._v(" "),r("div",{staticStyle:{float:"right","margin-right":"80px"}},[r("router-link",{staticStyle:{"text-decoration":"none",color:"aliceblue"},attrs:{to:{name:"PlanList"}}},[r("el-button",{staticClass:"return-list"},[r("i",{staticClass:"el-icon-close",staticStyle:{"margin-right":"5px"},attrs:{"return-list":""}}),e._v("取消\n          ")])],1),e._v(" "),r("el-button",{staticClass:"return-list",attrs:{type:"primary"},nativeOn:{click:function(t){return e.updatePlanInfo(t)}}},[r("i",{staticClass:"el-icon-check",staticStyle:{"margin-right":"5px"},attrs:{"return-list":""}}),e._v("保存\n        ")])],1)],1),e._v(" "),r("el-row",[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.formRules}},[r("div",{staticStyle:{border:"1px solid #e6e6e6","margin-bottom":"10px",padding:"15px"}},[r("el-row",[r("el-col",{attrs:{span:20}},[r("el-form-item",{attrs:{label:"计划名称:","label-width":"120px",prop:"name"}},[r("el-input",{attrs:{placeholder:"名称","auto-complete":""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",[r("el-form-item",{attrs:{label:"是否并行:","label-width":"120px",prop:"isParallel"}},[r("el-radio",{attrs:{label:!0},model:{value:e.form.isParallel,callback:function(t){e.$set(e.form,"isParallel",t)},expression:"form.isParallel"}},[e._v("是")]),e._v(" "),r("el-radio",{attrs:{label:!1},model:{value:e.form.isParallel,callback:function(t){e.$set(e.form,"isParallel",t)},expression:"form.isParallel"}},[e._v("否")])],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:20}},[r("el-form-item",{attrs:{label:"计划描述:","label-width":"120px",prop:"description"}},[r("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入计划描述","auto-complete":""},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:20}},[r("el-form-item",{attrs:{label:"secretToken:","label-width":"120px",prop:"secretToken"}},[r("el-input",{attrs:{"auto-complete":"off"},model:{value:e.form.secretToken,callback:function(t){e.$set(e.form,"secretToken",t)},expression:"form.secretToken"}})],1)],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"告警邮件组","label-width":"120px",prop:"alarmMailGroupList"}},[r("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",multiple:"",placeholder:"请选择告警报告接受者(可多选)"},on:{"visible-change":e.checkActiveMail},model:{value:e.form.alarmMailGroupList,callback:function(t){e.$set(e.form,"alarmMailGroupList",t)},expression:"form.alarmMailGroupList"}},e._l(e.mailGroupList,function(e,t){return r("el-option",{key:t,attrs:{label:e.name,value:e._id}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"触发邮件","label-width":"120px",prop:"alwaysSendMail"}},[r("el-radio-group",{model:{value:e.form.alwaysSendMail,callback:function(t){e.$set(e.form,"alwaysSendMail",t)},expression:"form.alwaysSendMail"}},[r("el-radio",{attrs:{label:!0}},[e._v("执行成功也触发邮件")]),e._v(" "),r("el-radio",{attrs:{label:!1}},[e._v("执行失败才触发邮件")])],1)],1),e._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:22}},[r("el-form-item",{attrs:{label:"测试范围:",prop:"executionRange","label-width":"100px"}},[r("el-table",{attrs:{data:e.form.executionRange,"highlight-current-row":""}},[r("el-table-column",{attrs:{label:"项目","min-width":"30%",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-form-item",{attrs:{prop:"executionRange."+t.$index+".projectId",rules:e.formRules.range_projectId}},[r("el-select",{staticStyle:{width:"90%"},attrs:{prop:"executionRange."+t.$index+".projectId",placeholder:"请选择项目",clearable:"",filterable:"","allow-create":"","default-first-option":""},model:{value:t.row.projectId,callback:function(r){e.$set(t.row,"projectId",r)},expression:"scope.row.projectId"}},e._l(e.projects,function(e,t){return r("el-option",{key:t+"",attrs:{label:e.name,value:e._id}})}),1)],1)]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"优先级","min-width":"10%"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-form-item",{attrs:{prop:"executionRange."+t.$index+".priority",rules:e.formRules.range_priority}},[r("el-select",{staticStyle:{width:"90%"},attrs:{placeholder:"请选择优先级",clearable:"",filterable:"","allow-create":"","default-first-option":""},model:{value:t.row.priority,callback:function(r){e.$set(t.row,"priority",r)},expression:"scope.row.priority"}},e._l(e.priorityOptions,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"操作","min-width":"5%"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-form-item",[r("i",{staticClass:"el-icon-delete",staticStyle:{"font-size":"30px",cursor:"pointer"},on:{click:function(r){return e.delExecutionRange(t.$index)}}})])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"","min-width":"10%"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-form-item",[t.$index===e.form.executionRange.length-1?r("el-button",{staticClass:"el-icon-plus",attrs:{size:"mini"},on:{click:e.addExecutionRange}}):e._e()],1)]}}])})],1)],1)],1)],1)],1)])],1)],1)},staticRenderFns:[]};var n=r("VU/8")(o,s,!1,function(e){r("3u7a")},"data-v-254cbf84",null);t.default=n.exports},"3u7a":function(e,t){}});
//# sourceMappingURL=27.0f8288e3825923de6230.js.map