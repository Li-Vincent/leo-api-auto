webpackJsonp([3],{"7Ifc":function(t,e){},FrIa:function(t,e,a){"use strict";e.a=function(t,e){return Object(s.a)({url:"/api/project/"+t+"/testEnv/"+e,method:"GET"})};var s=a("cKc3")},"xL/h":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("woOf"),r=a.n(s),i=a("zsD7"),o=a("FrIa"),n=a("cKc3");function l(t,e,a,s){return Object(n.a)({url:"/api/project/"+t+"/testEnv/updateParam/"+e,method:"POST",headers:s,data:a})}var m={name:"TestEnvParam",data:function(){return{testEnvName:"",filters:{name:""},testEnvParams:[],size:10,skip:0,sortBy:"createAt",order:"descending",pageNum:1,totalNum:0,listLoading:!1,statusChangeLoading:!1,selects:[],titleMap:{add:"新增",edit:"编辑"},dialogStatus:"",formVisible:!1,loading:!1,formRules:{name:[{required:!0,message:"请输入参数名",trigger:"blur"},{min:1,max:30,message:"长度在 1 到 30 个字符",trigger:"blur"}],paramValue:[{required:!0,message:"请输入参数值",trigger:"blur"},{min:1,max:50,message:"长度在 1 到 50 个字符",trigger:"blur"}],description:[{required:!1,message:"请输入描述",trigger:"blur"},{max:1024,message:"不能超过1024个字符",trigger:"blur"}]},form:{name:"",paramValue:"",description:""},initForm:{name:"",paramValue:"",description:""}}},methods:{queryEnvParams:function(t){this.listLoading=!0;var e=this;""!==e.filters.name.trim()&&(t.name=e.filters.name.trim());(function(t,e,a,s){return Object(n.a)({url:"/api/project/"+t+"/testEnv/"+e+"/paramList",headers:s,params:a,method:"GET"})})(this.$route.params.project_id,this.$route.params.test_env_id,t,{}).then(function(t){var a=t.status,s=t.data;e.listLoading=!1,"ok"===a?(e.totalNum=s.totalNum,e.testEnvParams=s.rows):e.$message.error({message:s,center:!0})}).catch(function(t){e.$message.error({message:"参数列表获取失败，请稍后刷新重试哦~",center:!0}),e.listLoading=!1})},getEnvParamList:function(){var t={size:this.size,skip:this.skip,sortBy:this.sortBy,order:this.order,projectId:this.$route.params.project_id,testEnvId:this.$route.params.test_env_id};this.queryEnvParams(t)},handleSizeChange:function(t){this.size=t;var e={size:this.size,skip:this.skip,sortBy:this.sortBy,order:this.order,projectId:this.$route.params.project_id,testEnvId:this.$route.params.test_env_id};this.queryEnvParams(e)},handleCurrentChange:function(t){this.skip=(t-1)*this.size;var e={size:this.size,skip:this.skip,sortBy:this.sortBy,order:this.order,projectId:this.$route.params.project_id,testEnvId:this.$route.params.test_env_id};this.queryEnvParams(e)},sortChange:function(t){this.sortBy=t.prop,this.order=t.order;var e={size:this.size,skip:this.skip,sortBy:this.sortBy,order:this.order,projectId:this.$route.params.project_id,testEnvId:this.$route.params.test_env_id};this.queryEnvParams(e)},handleDel:function(t,e){var a=this;this.$confirm("确认删除该记录吗?","提示",{type:"warning"}).then(function(){a.listLoading=!0;var t=a;l(a.$route.params.project_id,e._id,{isDeleted:!0},{"Content-Type":"application/json"}).then(function(e){var a=e.status,s=e.data;"ok"===a?t.$message({message:"删除成功",center:!0,type:"success"}):t.$message.error({message:s,center:!0}),t.getEnvParamList()})})},handleChangeStatus:function(t,e){var a=this;a.statusChangeLoading=!0;var s={status:!e.status};l(this.$route.params.project_id,e._id,s,{"Content-Type":"application/json"}).then(function(t){var s=t.status,r=t.data;a.statusChangeLoading=!1,"ok"===s?(a.$message({message:"状态变更成功",center:!0,type:"success"}),e.status=!e.status):a.$message.error({message:r,center:!0}),a.getEnvParamList()}).catch(function(){a.$message.error({message:"环境状态更新失败,请稍后重试哦",center:!0}),a.statusChangeLoading=!1,a.getEnvParamList()})},handleEdit:function(t,e){this.formVisible=!0,this.form=r()({},this.form,e),this.dialogStatus="edit"},handleAdd:function(){this.formVisible=!0,this.form=r()({},this.form,this.initForm),this.dialogStatus="add"},submit:function(){var t=this,e=this;this.$refs.form.validate(function(a){a&&t.$confirm("确认提交吗？","提示",{}).then(function(){e.loading=!0;var a={"Content-Type":"application/json"};if("edit"==t.dialogStatus){var s={project_id:t.$route.params.project_id,name:e.form.name,paramValue:e.form.paramValue,description:e.form.description.trim(),lastUpdateUser:unescape(Object(i.a)("email").replace(/\\u/g,"%u"))||"anonymous"};l(t.$route.params.project_id,e.form._id,s,a).then(function(t){var a=t.status,s=t.data;e.loading=!1,"ok"===a?(e.$message({message:"修改成功",center:!0,type:"success"}),e.$refs.form.resetFields(),e.formVisible=!1,e.getEnvParamList()):(e.$message.error({message:s,center:!0}),e.getEnvParamList())})}else if("add"==t.dialogStatus){var r={name:e.form.name,paramValue:e.form.paramValue,description:e.form.description.trim(),createUser:unescape(Object(i.a)("email").replace(/\\u/g,"%u"))||"anonymous"};(function(t,e,a,s){return Object(n.a)({url:"/api/project/"+t+"/testEnv/"+e+"/addParam",headers:s,method:"POST",data:a})})(t.$route.params.project_id,t.$route.params.test_env_id,r,a).then(function(t){var a=t.status,s=t.data;e.loading=!1,"ok"===a?(e.$message({message:"添加成功",center:!0,type:"success"}),e.$refs.form.resetFields(),e.formVisible=!1,e.getEnvParamList()):(e.$message.error({message:s,center:!0}),e.$refs.form.resetFields(),e.formVisible=!1,e.getEnvParamList())})}else e.$message.error({message:"系统出错",center:!0}),e.getEnvParamList()})})},selectsChange:function(t){this.selects=t},reportRowStyle:function(t){var e=t.row;t.rowIndex;return!0!==e.status?"background-color: #DDDDDD":""},ReportTableRow:function(t){t.row,t.rowIndex;return"reportTableRow"}},mounted:function(){var t=this;this.getEnvParamList(),Object(o.a)(this.$route.params.project_id,this.$route.params.test_env_id).then(function(e){"ok"===e.status&&(t.testEnvName=e.data.name)})}},c={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",[s("strong",{staticClass:"title"},[t._v(t._s(t.$route.meta.title)+" "),t.testEnvName?s("span",[t._v(" - 环境: "+t._s(t.testEnvName))]):t._e()]),t._v(" "),s("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[s("el-form",{attrs:{inline:!0,model:t.filters},nativeOn:{submit:function(t){t.preventDefault()}}},[s("router-link",{staticStyle:{"text-decoration":"none",color:"aliceblue"},attrs:{to:""}},[s("el-button",{staticClass:"return-list",on:{click:function(e){return t.$router.back(-1)}}},[s("i",{staticClass:"el-icon-d-arrow-left",staticStyle:{"margin-right":"5px"}}),t._v("返回\n        ")])],1),t._v(" "),s("el-form-item",{staticStyle:{"margin-left":"35px"}},[s("el-button",{staticClass:"el-icon-plus",attrs:{type:"primary"},on:{click:t.handleAdd}},[t._v("新增参数")])],1),t._v(" "),s("div",{staticStyle:{float:"right","margin-right":"95px"}},[s("el-form-item",[s("el-input",{attrs:{placeholder:"名称"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getEnvParamList(e)}},model:{value:t.filters.name,callback:function(e){t.$set(t.filters,"name","string"==typeof e?e.trim():e)},expression:"filters.name"}})],1),t._v(" "),s("el-form-item",[s("el-button",{staticClass:"el-icon-search",attrs:{type:"primary"},on:{click:t.getEnvParamList}},[t._v(" 查询")])],1)],1)],1)],1),t._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:t.testEnvParams,"row-style":t.reportRowStyle,"row-class-name":t.ReportTableRow,"highlight-current-row":""},on:{"sort-change":t.sortChange,"selection-change":t.selectsChange}},[s("el-table-column",{attrs:{type:"selection","min-width":"5%"}}),t._v(" "),s("el-table-column",{attrs:{prop:"name",label:"参数名","min-width":"20%",sortable:"custom","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-icon",{attrs:{name:"name"}}),t._v("\n        "+t._s(e.row.name)+"\n      ")]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"paramValue",label:"参数值","min-width":"20%",sortable:"custom","show-overflow-tooltip":""}}),t._v(" "),s("el-table-column",{attrs:{prop:"description",label:"描述","min-width":"35","show-overflow-tooltip":""}}),t._v(" "),s("el-table-column",{attrs:{prop:"createAt",label:"创建时间","min-width":"20%",sortable:"custom","show-overflow-tooltip":""}}),t._v(" "),s("el-table-column",{attrs:{prop:"createUser",label:"创建者","min-width":"20%",sortable:"custom","show-overflow-tooltip":""}}),t._v(" "),s("el-table-column",{attrs:{prop:"lastUpdateTime",label:"更新时间","min-width":"20%",sortable:"custom","show-overflow-tooltip":""}}),t._v(" "),s("el-table-column",{attrs:{prop:"lastUpdateUser",label:"更新者","min-width":"20%",sortable:"custom","show-overflow-tooltip":""}}),t._v(" "),s("el-table-column",{attrs:{prop:"status",label:"状态","min-width":"20%",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("img",{directives:[{name:"show",rawName:"v-show",value:e.row.status,expression:"scope.row.status"}],attrs:{src:a("7shL")}}),t._v(" "),s("img",{directives:[{name:"show",rawName:"v-show",value:!e.row.status,expression:"!scope.row.status"}],attrs:{src:a("IT+J")}})]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"操作","min-width":"50%"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return t.handleEdit(e.$index,e.row)}}},[t._v("编辑")]),t._v(" "),s("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(a){return t.handleDel(e.$index,e.row)}}},[t._v("删除")]),t._v(" "),s("el-button",{attrs:{type:"info",size:"small",loading:t.statusChangeLoading},on:{click:function(a){return t.handleChangeStatus(e.$index,e.row)}}},[t._v("\n          "+t._s(!1===e.row.status?"启用":"禁用")+"\n        ")])]}}])})],1),t._v(" "),s("el-col",{staticClass:"toolbar",attrs:{span:24}},[s("el-pagination",{staticStyle:{float:"right"},attrs:{"page-sizes":[10,20,40],"page-size":t.size,layout:"total, sizes, prev, pager, next, jumper",total:t.totalNum},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t._v(" "),s("el-dialog",{staticStyle:{width:"60%",left:"20%"},attrs:{title:t.titleMap[t.dialogStatus],visible:t.formVisible,"close-on-click-modal":!1},on:{"update:visible":function(e){t.formVisible=e}}},[s("el-form",{ref:"form",attrs:{model:t.form,rules:t.formRules,"label-width":"80px"}},[s("el-form-item",{attrs:{label:"参数名",prop:"name"}},[s("el-input",{attrs:{placeholder:"请输入参数名","auto-complete":"off"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name","string"==typeof e?e.trim():e)},expression:"form.name"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"参数值",prop:"paramValue"}},[s("el-input",{attrs:{placeholder:"请输入参数值","auto-complete":"off"},model:{value:t.form.paramValue,callback:function(e){t.$set(t.form,"paramValue",e)},expression:"form.paramValue"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"描述",prop:"description"}},[s("el-input",{attrs:{placeholder:"请输入描述...",type:"textarea",rows:5},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1),t._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{nativeOn:{click:function(e){t.formVisible=!1}}},[t._v("取消")]),t._v(" "),s("el-button",{attrs:{type:"primary",loading:t.loading},nativeOn:{click:function(e){return t.submit(e)}}},[t._v("提交")])],1)],1)],1)},staticRenderFns:[]};var u=a("VU/8")(m,c,!1,function(t){a("7Ifc")},"data-v-617428c6",null);e.default=u.exports},zsD7:function(t,e,a){"use strict";function s(t){if(document.cookie.length>0){var e=document.cookie,a=e.indexOf(" "+t+"=")>0?e.indexOf(" "+t+"=")+1:0,s=e.indexOf(";"+t+"=")>0?e.indexOf(";"+t+"=")+1:0,r=0===e.indexOf(t+"=")?0:-1,i=a||s||r;if(-1!==i){i=i+t.length+1;var o=e.indexOf(";",i);return-1===o&&(o=e.length),e.substring(i,o)}}return""}e.a=s}});
//# sourceMappingURL=3.10afb0189acab5e90283.js.map